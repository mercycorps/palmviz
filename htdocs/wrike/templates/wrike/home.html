{% extends 'base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load humanize %}
{% load customtags %}


{% block content %}
    <div class="row">
        <form class="form-inline" id="date_range_form" method="GET">
            <div class="form-group">
                <div class="input-daterange input-group" id="datepicker">
                    <input type="text" class="form-control input-sm" name="start" placeholder="From Date">
                    <span class="input-group-addon">to</span>
                    <input type="text" class="form-control input-sm" name="end" placeholder="To Date">
                </div>
            </div>
            <button type="submit" class="btn btn-sm btn-default">Submit</button>
        </form>
    </div>
    <div id="container"></div>
    <div id="categories" style="display: none;">{{ categories }}</div>
    <div id="data" style="display: none;">{{ data }}</div>
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">
"use strict";
/*
$("body").on("submit", "#date_range_form", function(e) {
    e.preventDefault();
    var filters = {};
    $("#date_range_form *").filter(":input").each(function() {
        if (this.name != 'submit' && this.name != 'reset' && this.value && this.name != '') {
            var values = new Array($(this).val());
            filters[this.name] = values.join(",");
        }
    });
    console.log(filters);
    draw_chart();
});
*/

function draw_chart() {
    var categories = $.parseJSON($("#categories").html());
    var data = $.parseJSON($("#data").html());

    var chart_config = {
        chart: {
            height: 600,
            type: 'bar'
        },
        credits: {
            enabled: false,
        },
        title: {
            text: 'PALM Field Support By Country'
        },
        xAxis: {
            categories: categories
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total # of Support Instances'
            }
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        legend: {
            align: 'right',
            verticalAlign: 'middle',
            layout: 'vertical'
        },
        series: data
    };
    $("#container").highcharts(chart_config);
}
$(function () {
    draw_chart();
});
/*
$(function () {
    var categories = $.parseJSON($("#categories").html());
    var data = $.parseJSON($("#data").html());

    Highcharts.chart('container', {
        chart: {
            height: 600,
            type: 'bar'
        },
        credits: {
            enabled: false,
        },
        title: {
            text: 'PALM Field Support By Country'
        },
        xAxis: {
            categories: categories
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total # of Support Instances'
            }
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: data
    });
});
*/
</script>
{% endblock extra_js %}