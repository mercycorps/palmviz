{% extends 'base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load humanize %}
{% load customtags %}


{% block content %}
    <div class="row">
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">Completion Date Range Filter</h3>
            </div>
            <div class="panel-body">
                <form class="form-inline" id="date_range_form" method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <div class="input-daterange input-group" id="datepicker">
                            <input type="text" class="form-control input-sm" name="start" placeholder="From Date" value={{start_date}}>
                            <span class="input-group-addon">to</span>
                            <input type="text" class="form-control input-sm" name="end" placeholder="To Date" value={{end_date}}>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary">Filter</button>
                    <button type="reset" class="btn btn-sm btn-danger">Clear</button>
                </form>
            </div>
        </div>
    </div>
    <div id="container"></div>
    <div id="categories" style="display: none;">{{ categories }}</div>
    <div id="data" style="display: none;">{{ data }}</div>
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">
    "use strict";

    $(function () {
        draw_chart();
    });

    $("body").on("reset", "#date_range_form", function(e) {
        e.preventDefault();
        var form = this;
        $(':input', form).each(function() {
            var type = this.type;
            if (type == 'text')
                this.value = '';
        });
        window.location.replace(location.href);
    });

    function draw_chart() {
        var categories = $.parseJSON($("#categories").html());
        var data = $.parseJSON($("#data").html());

        var chart_config = {
            chart: {
                height: 600,
                type: 'bar'
            },
            credits: {
                enabled: false,
            },
            title: {
                text: 'PALM Field Support'
            },
            xAxis: {
                categories: categories
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Total # of Support Instances'
                }
            },
            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },
            legend: {
                align: 'right',
                verticalAlign: 'middle',
                layout: 'vertical'
            },
            series: data
        };
        $("#container").highcharts(chart_config);
    }

</script>
{% endblock extra_js %}